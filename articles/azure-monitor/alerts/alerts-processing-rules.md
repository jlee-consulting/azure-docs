---
title: Alert processing rules for Azure Monitor alerts
description: Understanding what alert processing rules in Azure Monitor are and how to configure and manage them.
ms.topic: conceptual
ms.date: 2/23/2022
ms.reviewer: ofmanor

---

# Alert processing rules

<a name="configuring-an-action-rule"></a>
<a name="suppression-of-alerts"></a>

> [!NOTE]
> The previous name for alert processing rules was **action rules**. The Azure resource type of these rules remains **Microsoft.AlertsManagement/actionRules** for backward compatibility.

Alert processing rules allow you to apply processing on **fired alerts**. You may be familiar with Azure Monitor alert rules, which are rules that generate new alerts. Alert processing rules are different; they are rules that modify the fired alerts themselves as they are being fired. You can use alert processing rules to add [action groups](./action-groups.md) or remove (suppress) action groups from your fired alerts. Alert processing rules can be applied to different resource scopes, from a single resource to an entire subscription. They can also allow you to apply various filters or have the rule work on a pre-defined schedule.

## What are alert processing rules useful for?

Some common use cases for alert processing rules include:

### Notification suppression during planned maintenance

Many customers set up a planned maintenance time for their resources, either on a one-off basis or on a regular schedule. The planned maintenance may cover a single resource like a virtual machine, or multiple resources like all virtual machines in a resource group. So, you may want to stop receiving alert notifications for those resources during the maintenance window. In other cases, you may prefer to not receive alert notifications at all outside of your business hours. Alert processing rules allow you to achieve that.

You could alternatively suppress alert notifications by disabling the alert rules themselves at the beginning of the maintenance window, and re-enabling them once the maintenance is over. In that case, the alerts won't fire in the first place. However, that approach has several limitations:
   * This approach is only practical if the scope of the alert rule is exactly the scope of the resources under maintenance. For example, a single alert rule might cover multiple resources, but only a few of those resources are going through maintenance. So, if you disable the alert rule, you will not be alerted when the remaining resources covered by that rule run into issues.
   * You may have many alert rules that cover the resource. Updating all of them is time consuming and error prone.
   * You might have some alerts that are not created by an alert rule at all, like alerts from Azure Backup.  
 
In all these cases, an alert processing rule provides an easy way to achieve the notification suppression goal.

### Management at scale

Most customers tend to define a few action groups that are used repeatedly in their alert rules. For example, they may want to call a specific action group whenever any high severity alert is fired. As their number of alert rule grows, manually making sure that each alert rule has the right set of action groups is becoming harder. 

Alert processing rules allow you to specify that logic in a single rule, instead of having to set it consistently in all your  alert rules. They also cover alert types that are not generated by an alert rule.

### Add action groups to all alert types

Azure Monitor alert rules let you select which action groups will be triggered when their alerts are fired. However, not all Azure alert sources let you specify action groups. Some examples of such alerts include [Azure Backup alerts](../../backup/backup-azure-monitoring-built-in-monitor.md), [VM Insights guest health alerts](../vm/vminsights-health-alerts.md), [Azure Stack Edge](../../databox-online/azure-stack-edge-gpu-manage-device-event-alert-notifications.md), and Azure Stack Hub.

For those alert types, you can use alert processing rules to add action groups.

> [!NOTE]
> Alert processing rules do not affect [Azure Service Health](../../service-health/service-health-overview.md) alerts.

## Alert processing rule properties
<a name="filter-criteria"></a>

An alert processing rule definition covers several aspects:

### Which fired alerts are affected by this rule? 

**SCOPE**  
Each alert processing rule has a scope. A scope is a list of one or more specific Azure resources, or specific resource group, or an entire subscription. **The alert processing rule will apply to alerts that fired on resources within that scope**.  

**FILTERS**  
You can also define filters to narrow down which specific subset of alerts are affected within the scope. The available filters are:  

* **Alert Context (payload)** - the rule will apply only to alerts that contain any of the filter's strings within the [alert context](./alerts-common-schema-definitions.md#alert-context) section of the alert. This section includes fields specific to each alert type.
* **Alert rule id** - the rule will apply only to alerts from a specific alert rule. The value should be the full resource ID, for example `/subscriptions/SUB1/resourceGroups/RG1/providers/microsoft.insights/metricalerts/MY-API-LATENCY`.  
You can locate the alert rule ID by opening a specific alert rule in the portal, clicking "Properties", and copying the "Resource ID" value. You can also locate it by listing your alert rules from PowerShell or CLI.
* **Alert rule name** - the rule will apply only to alerts with this alert rule name. Can also be useful with a "Contains" operator.
* **Description** - the rule will apply only to alerts that contain the specified string within the alert rule description field.
* **Monitor condition** - the rule will apply only to alerts with the specified monitor condition, either "Fired" or "Resolved".
*  **Monitor service** - the rule will apply only to alerts from any of the specified monitor services.  
For example, use "Platform" to have the rule apply only to metric alerts.
* **Resource** - the rule will apply only to alerts from the specified Azure resource.  
For example, you can use this filter with "Does not equal" to exclude one or more resources when the rule's scope is a subscription.  
* **Resource group** - the rule will apply only to alerts from the specified resource groups.  
For example, you can use this filter with "Does not equal" to exclude one or more resource groups when the rule's scope is a subscription.  
* **Resource type** - the rule will apply only to alerts on resource from the specified resource types, such as virtual machines. You can use "Equals" to match one or more specific resources, or you can use contains to match a resource type and all its child resources.  
For example, use `resource type contains "MICROSOFT.SQL/SERVERS"` to match both SQL servers and all their child resources, like databases.
* **Severity** - the rule will apply only to alerts with the selected severities.  

**FILTERS BEHAVIOR**  
* If you define multiple filters in a rule, all of them apply - there is a logical AND between all filters.  
  For example, if you set both `resource type = "Virtual Machines"` and `severity = "Sev0"`, then the rule will apply only for Sev0 alerts on virtual machines in the scope.
* Each filter may include up to five values, and there is a logical OR between the values.  
  For example, if you set `description contains ["this", "that"]`, then the rule will apply only to alerts whose description contains either "this" or "that".

### What should this rule do?

Choose one of the following actions:

* **Suppression**  
This action removes all the action groups from the affected fired alerts. So, the fired alerts will not invoke any of their action groups (not even at the end of the maintenance window). Those fired alerts will still be visible when you list your alerts in the portal, Azure Resource Graph, API, PowerShell etc.
The suppression action has a higher priority over the "apply action groups" action - if a single fired alert is affected by different alert processing rules of both types, the action groups of that alert will be suppressed.

* **Apply action groups**  
This action adds one or more action groups to the affected fired alerts.

### When should this rule apply?

You may optionally control when will the rule apply. By default, the rule is always active. However, you can select a one-off window for this rule to apply, or have a recurring window such as a weekly recurrence. 

## Configuring an alert processing rule

### [Portal](#tab/portal)

You can access alert processing rules by navigating to the **Alerts** home page in Azure Monitor.  
Once there, you can click **Alert processing rules** to see and manage your existing rules, or click **Create** --> **Alert processing rules** to open the new alert processing rule wizard.

:::image type="content" source="media/alerts-processing-rules/alerts-page-processing-rules.png" alt-text="Screenshot showing how to access alert processing rules from the Azure Monitor landing page.":::

Lets review the new alert processing rule wizard.  
In the first tab (**Scope**), you select which fired alerts are covered by this rule. Pick the **scope** of resources whose alerts will be covered - you may choose multiple resources and resource groups, or an entire subscription. You may also optionally add **filters**, as documented above.

:::image type="content" source="media/alerts-processing-rules/alert-processing-rule-scope.png" alt-text="Screenshot of the scope tab of the alert processing rules wizard.":::

In the second tab (**Rule settings**), you select which action to apply on the affected alerts. Choose between **Suppression** or **Apply action group**. If you choose the apply action group, you can either select existing action groups by clicking **Add action groups**, or create a new action group.

:::image type="content" source="media/alerts-processing-rules/alert-processing-rule-settings.png" alt-text="Screenshot of the rule settings tab of the alert processing rules wizard.":::

In the third tab (**Scheduling**), you select an optional schedule for the rule. By default the rule works all the time, unless you disable it. However, you can set it to work **on a specific time**, or **set up a recurring schedule**.  
Let's see an example of a schedule for a one-off, overnight, planned maintenance. It starts in the evening until the next morning, in a specific timezone:

:::image type="content" source="media/alerts-processing-rules/alert-processing-rule-scheduling-one-time.png" alt-text="Screenshot of the scheduling tab of the alert processing rules wizard with a one time rule.":::

Let's see an example of a more complex schedule, covering an "outside of business hours" case. It has a recurring schedule with two recurrences - a daily one from the afternoon until the morning, and a weekly one covering Saturday and Sunday (full days).

:::image type="content" source="media/alerts-processing-rules/alert-processing-rule-scheduling-recurring.png" alt-text="Screenshot of the scheduling tab of the alert processing rules wizard with a recurring rule.":::

In the fourth tab (**Details**), you give this rule a name, pick where it will be stored, and optionally add a description for your reference. In the fifth tab (**Tags**), you optionally add tags to the rule, and finally in the last tab you can review and create the alert processing rule.

### [Azure CLI](#tab/azure-cli)

You can use the Azure CLI to work with alert processing rules. See the `az monitor alert-processing-rules` [page in the Azure CLI docs](/cli/azure/monitor/alert-processing-rule)  for detailed documentation and examples.

### Prepare your environment

1. **Install the Auzre CLI**

   Follow the [Installation instructions for the Azure CLI](/cli/azure/install-azure-cli).

   Alternatively, you can use Azure Cloud Shell, which is an interactive shell environment that you use through your browser. To start a Cloud Shell:

   - Open Cloud Shell by going to [https://shell.azure.com](https://shell.azure.com)

   - Select the **Cloud Shell** button on the menu bar at the upper right corner in the [Azure portal](https://portal.azure.com)

1. **Sign in**

   If you're using a local installation of the CLI, sign in using the `az login` [command](/cli/azure/reference-index#az-login). Follow the steps displayed in your terminal to complete the authentication process.

    ```azurecli
    az login
    ```

1. **Install the `alertsmanagement` extension**

   In order to use the `az monitor alert-processing-rule` commands, install the `alertsmanagement` preview extension.

   ```azurecli
   az extension add --name alertsmanagement
   ```

   The following output is expected.

   ```output
   The installed extension 'alertsmanagement' is in preview.
   ```
   
   To learn more about Azure CLI extensions, check [Use extension with Azure CLI](/cli/azure/azure-cli-extensions-overview?).

### Create an alert processing rule with the Azure CLI

Use the `az monitor alert-processing-rule create` command to create alert processing rules.  
For example, to create a rule that adds an action group to all alerts in a subscription, run:

```azurecli
az monitor alert-processing-rule create \
  --name 'AddActionGroupToSubscription' \
  --rule-type AddActionGroups \
  --scopes "/subscriptions/SUB1" \
  --action-groups "/subscriptions/SUB1/resourcegroups/RG1/providers/microsoft.insights/actiongroups/AG1" \
  --resource-group RG1 \
  --description "Add action group AG1 to all alerts in the subscription"
```

The [CLI documentation](/cli/azure/monitor/alert-processing-rule#az-monitor-alert-processing-rule-create) include more examples and an explanation of each parameter.

### [PowerShell](#tab/powershell)

You can use PowerShell to work with alert processing rules. See the `*-AzAlertProcessingRule` commands [in the PowerShell docs](/powershell/module/az.alertsmanagement) for detailed documentation and examples.


### Create an alert processing rule using PowerShell

Use the `Set-AzAlertProcessingRule` command to create alert processing rules.  
For example, to create a rule that adds an action group to all alerts in a subscription, run:

```powershell
Set-AzAlertProcessingRule `
  -Name AddActionGroupToSubscription `
  -AlertProcessingRuleType AddActionGroups `
  -Scope /subscriptions/SUB1 `
  -ActionGroupId /subscriptions/SUB1/resourcegroups/RG1/providers/microsoft.insights/actiongroups/AG1 `
  -ResourceGroupName RG1 `
  -Description "Add action group AG1 to all alerts in the subscription"
```

The [PowerShell documentation](/cli/azure/monitor/alert-processing-rule#az-monitor-alert-processing-rule-create) include more examples and an explanation of each parameter.

* * *

## Managing alert processing rules

### [Portal](#tab/portal)

You can view and manage your alert processing rules from the list view:

:::image type="content" source="media/alerts-processing-rules/alert-processing-rules-list-view.png" alt-text="Screenshot of the list view of alert processing rules.":::

From here, you can enable, disable, or delete alert processing rules at scale by selecting the check box next to them. Clicking on an alert processing rule will open it for editing - you can enable or disable the rule in the fourth tab (**Details**).

### [Azure CLI](#tab/azure-cli)

You can view and manage your alert processing rules using the [az monitor alert-processing-rules](/cli/azure/monitor/alert-processing-rule) commands from Azure CLI.

Before you manage alert processing rules with the Azure CLI, prepare your environment using the instructions provided in [Configuring an alert processing rule](#configuring-an-alert-processing-rule).

```azurecli
# List all alert processing rules for a subscription
az monitor alert-processing-rules list

# Get details of an alert processing rule
az monitor alert-processing-rules show --resource-group RG1 --name MyRule

# Update an alert processing rule
az monitor alert-processing-rules update --resource-group RG1 --name MyRule --status Disabled

# Delete an alert processing rule
az monitor alert-processing-rules delete --resource-group RG1 --name MyRule
```

### [PowerShell](#tab/powershell)

You can view and manage your alert processing rules using the [\*-AzAlertProcessingRule](/powershell/module/az.alertsmanagement) commands from Azure CLI.

Before you manage alert processing rules with the Azure CLI, prepare your environment using the instructions provided in [Configuring an alert processing rule](#configuring-an-alert-processing-rule).

```powershell
# List all alert processing rules for a subscription
Get-AzAlertProcessingRule

# Get details of an alert processing rule
Get-AzAlertProcessingRule -ResourceGroupName RG1 -Name MyRule | Format-List

# Update an alert processing rule
Update-AzAlertProcessingRule -ResourceGroupName RG1 -Name MyRule -Enabled False

# Delete an alert processing rule
Remove-AzAlertProcessingRule -ResourceGroupName RG1 -Name MyRule
```

* * *

## Next steps

- [Learn more about alerts in Azure](./alerts-overview.md)
