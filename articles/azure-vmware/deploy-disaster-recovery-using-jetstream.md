---
title: Deploy disaster recovery using JetStream 
description: Learn how to deploy JetStream Disaster Recovery (DR) for your Azure VMware Solution private cloud and on-premises VMware workloads. 
ms.topic: how-to
ms.date: 08/31/2021

---

# Deploy disaster recovery using JetStream

[JetStream Disaster Recovery (DR)](https://www.jetstreamsoft.com/product-portfolio/jetstream-dr/) is installed in a VMware vSphere environment and managed through a vCenter plug-in appliance. It provides cloud-native Continuous Data Protection (CDP), which constantly replicates virtual machine (VM) I/O operations. Instead of capturing snapshots at regular intervals, it continuously captures and replicates data as it's written to the primary storage with minimal effect on running applications.  As a result, it allows you to quickly recover VMs and their data, reaching a lower recovery point objective (RPO).  

With Azure VMware Solution, you can store data directly to a recovery cluster in vSAN or an attached file system like Azure NetApp Files. The data gets captured through I/O filters that run within vSphere. The underlying data store can be VMFS, VSAN, vVol, or any HCI platform. 

:::image type="content" source="media/jetstream-disaster-recovery/jetstream-disaster-recovery-diagram.png" alt-text="Diagram showing the JetStream DR and Azure VMware Solution integration." border="false":::

JetStream DR software consists of three main components: 

- Management Server Virtual Appliance (MSA) is installed and configured before DR protection. 

- DR Virtual Appliance (DRVA) is an .ISO image that the JetStream DR MSA automatically deploys.

- Host components (IO Filter packages) 

The MSA is used to install and configure host components on the compute cluster and then to administer JetStream DR software. The DRVA runs the data path DR components. Multiple DRVAs can run concurrently for better scalability. Each DRVA has one or more dedicated partitions attached as an iSCSI LUN or as a low‐latency VDISK. The partitions are used to maintain replication logs and repositories for persistent metadata.

In this article, you'll deploy and learn how to use JetStream DR in your Azure VMware Solution private cloud and on-premises VMware workloads.


## Supported scenarios
Depending on the protection services required and the type of private cloud protected, you can deploy JetStream DR in two ways:

- On-premises to cloud

- Cloud to cloud

### On-premises to cloud deployment
VMs running in an organization's VMware‐based data center are continuously replicated to Microsoft Azure. As a result, VMs can resume operation in Azure VMware Solution if there's an incident in the on-premises data center. While the VMs are running in the recovery environment, they continue to replicate data for continued protection. After the on‐premises data center is restored, the VMs and their data (including any new data generated by the VMs in the recovery environment) can return to their original data center without interruption.

:::image type="content" source="media/jetstream-disaster-recovery/jetstream-on-premises-to-cloud-diagram.png" alt-text="Diagram showing the on-premises to Azure VMware Solution private cloud JetStream deployment." border="false":::

### Cloud to cloud deployment

In this configuration, Azure VMware Solution hosts your primary environment in one data center. It protects the VMs and the data by continuously replicating to another private cloud in another of its data centers. If there is an incident, VMs and data are recovered in the second data center. This protection can be bi‐directional, with data center "A" protecting "B", and vice‐versa.

:::image type="content" source="media/jetstream-disaster-recovery/jetstream-cloud-to-cloud-diagram.png" alt-text="Diagram showing the Azure VMware Solution private cloud to private cloud JetStream deployment." border="false":::


## Prerequisites

- Azure VMware Solution private cloud deployed as a secondary region. 

- An Ubuntu Linux jump box with an ExpressRoute connection to your Azure VMware Solution private cloud. 

- Latest PowerShell installed onto the Linux jump box.

- Latest third-party module from PowerShell gallery installed.

### Protected site

The protected site hosts a **service cluster** for administrative services, such as vCenter, DNS, Active Directory, and **computer clusters** where protected line-of-business applications run. The protected site can be located on-premises or hosted in Azure VMware Solution.

Any of the following types can be used:

- Azure Blob Storage

- Azure VMware Solution vSAN

- Azure VMware Solution attached file system, such as Azure NetApp Files


| **Item**  | **Description**  |  
| --- | --- |  
| **vCenter Server**  | <ul><li>Supported version: 6.7</li><li>HTTPS port: If using a firewall, HTTPS port 443 must be open.</li><li>Connectivity: The JetStream DR Management Server Appliance FQDN must be reachable from vCenter. Otherwise, the plug-in installation fails.</li><li>Time: The vCenter and JetStream DR MSA clocks must be synchronized.</li></ul>  |
| **Distributed Resource Scheduler (DRS)**  | It’s recommended on the compute cluster for resource balancing.  |
| **Cluster**  | vSphere Hosts: VMs to be protected by JetStream DR must be part of a cluster.  |
| **vSphere Host**  | <ul><li>Supported version: 6.7U1 (build #10302608) or later</li><li>Connectivity: vCenter Server FQDN must be reachable from the host. Otherwise, the host configuration fails.</li><li>Time: The vSphere hosts and JetStream DR MSA clocks must be synchronized.</li><li>CIM Service: The CIM server must be enabled, which is the default setting.</li></ul>  |
| **JetStream DR MSA**  | <ul><li>CPU: 64 bit, 4 vCPUs</li><li>Memory: 4 GB</li><li>Disk space: 60 GB</li><li>Network: Static or dynamically assigned (DHCP) IP addresses can be used. The FQDN must be registered with DNS.</li><li>DNS: DNS name resolution for vSphere hosts and vCenter Server</li></ul>  |
| **JetStream DRVA**  | <ul><li>CPU: 4 cores</li><li>Memory: 8 GB</li><li>Network: Static or dynamically assigned (DHCP) IP addresses can be used.</li></ul>  |
| **Replication Log Store**  | The protected site should expose a low-latency, flash storage device that the hosts share in the cluster for optimal performance. This device can be controlled by the JetStream DR software or provided by a third party. It's used as a repository for the replication log. The DRVA and ESXi host(s) must have direct access to this storage over iSCSI.  |
| **Ports**  | When JetStream DR software is installed, a range of ports automatically opens on the source ESXi hosts. So for most users, no more action is necessary. However, in cases where the on-premises/source setup has special firewall rules blocking these ports, you'll need to open these ports manually.<br /><br />Port range: 32873-32878  |



### Recovery site

An Azure VMware Solution _pilot light_ cluster is established for failover recovery. Although the recovery site is created as part of the installation process, the recovery site cluster is not fully populated or used during normal operation. Failed over compute clusters are added to the recovery site on-demand in response to a disaster event.

### Network

A network with the following characteristics must be established between the protected site and the recovery site.

| **Items** | **Description** |
| --- | --- |
| **JetStream DR MSA**  | A management network is required for the MSA. This network is used for access to the JetStream DR RESTful APIs and making other data path calls. If a private network is available for connecting to the object store, this private network should be added to the MSA VM as a separate network. If no private network is available, make sure the management network can be used to connect to the object store. <br /><br />A dedicated external network can be used for object store access; otherwise, data traffic is sent over the management network.  | 
| **JetStream DRVA**  | If the only network used is the management network, make sure it has access to both IO Filter and the object store. If multiple networks exist within the cluster, all must be attached to the DRVA VMs.  | 
| **Recovery from Object Cloud Virtual Appliance (RocVA)**  | If the only network used is the management network, make sure it has access to both the ESXi host(s) and the object store. If multiple networks exist within the cluster, all must be attached to the RocVA VM. The RocVA is a temporary VM created automatically when needed for VM recovery, then removed when it is no longer needed.  | 
| **Object store / blob storage**  | The object store/Blob Storage should be accessible to both the protected site and the recovery site.  | 
| **Replication log store**  | DRVAs and ESXi host(s) must have direct access to this storage over iSCSI.  | 


## Install JetStream DR

JetStream DR installation is available through the Run command functionality in the Azure VMware Solution portal. You'll complete the installation in three steps.

:::image type="content" source="media/run-command/run-command-overview-jetstream.png" alt-text="Screenshot showing how to access the JetStream run commands available." lightbox="media/run-command/run-command-overview-jetstream.png":::


>[!NOTE]
>Run commands are executed one at a time in the order submitted.

### Check the current state of the system

You'll run the `Invoke-PreflightJetDRSystemCheck` cmdlet to check the state of your system and whether the minimal requirements for the script are met. It also checks the required vCenter configuration to executes other cmdlets.  

The cmdlet checks:

- PowerShell
- vCenter FQDN
- CloudAdmin role
- VMware modules

1. Sign in to the [Azure portal](https://portal.azure.com).

1. Select **Run command** > **Packages** > **Invoke-PreflightJetDRSystemCheck**.

1. Provide the required values or change the default values, and then select **Run**.

   | **Field** | **Value** |
   | --- | --- |
   | **Retain up to**  | Retention period of the cmdlet output. The default value is 60.  |
   | **Specify name for execution**  | Alphanumeric name, for example, **checkDRsystem**.  |
   | **Timeout**  | The period after which a cmdlet exits if taking too long to finish.  |

1. Check **Notifications** to see the progress. 



### Check cluster configuration

You'll run the `Invoke-PreflightJetDRInstall` cmdlet to check the following cluster configuration:

- If the cluster details are correct 
- Has at least four hosts (minimum)
- If there's a VM with the same name provided for installing MSA
- If there's any **jetdr** plug-in present in vCenter


1. Select **Run command** > **Packages** > **Invoke-PreflightJetDRInstall**.

1. Provide the required values or change the default values, and then select **Run**.

   | **Field** | **Value** |
   | --- | --- |
   | **VMName** | Name of MSA VM. For example, **jetstreamServer**. |
   | **Cluster** | Cluster name where MSA will be deployed. For example, **Cluster-1**. |
   | **ProtectedCluster** | Cluster to be protected. For example, **Cluster-1**. |
   | **Retain up to**  | Retention period of the cmdlet output. The default value is 60.  |
   | **Specify name for execution**  | Alphanumeric name, for example, **check_jetserverdetails**.  |
   | **Timeout**  | The period after which a cmdlet exits if taking too long to finish.  |

1. Check **Notifications** to see the progress.  

1. If errors are reported, you can go to the next step to deploy JetDR MSA.


### Deploy JetDR MSA

You'll run the `Install-JetDR` cmdlet to deploy JetDR MSA, register vCenter to the JetDR MSA, and configure clusters. The deployment downloads the JetDR bundle from Microsoft Server Media (MMS) and creates a new user with elevated privileges assigned. 

1. Select **Run command** > **Packages** > **Install-JetDR**.

1. Provide the required values or change the default values, and then select **Run**.

   | **Field** | **Value** |
   | --- | --- |
   | **Network** | Network mapping for the MSA to be deployed. For example, **VM Network**.  |
   | **HostName** | Hostname (FQDN) of the MSA to be deployed.  |
   | **Credential** | Credentials of root user of the MSA to be deployed.   |
   | **Gateway** | Gateway of the MSA to be deployed. Leave blank for DHCP.  |
   | **Dns** | DNS IP that MSA should use. Leave blank for DHCP.  |
   | **MSIp** | IP address of the MSA to be deployed. Leave blank for DHCP.  |
   | **Netmask** | Netmask of the MSA to be deployed. Leave blank for DHCP.  |
   | **Cluster** | Cluster name where MSA will be deployed. For example, **Cluster-1**. |
   | **VMName** | Name of MSA VM. For example, **jetstreamServer**. |
   | **Datastore** | Datastore where MSA will be deployed.  |
   | **ProtectedCluster** | Cluster to be protected. For example, **Cluster-1**. |
   | **RegisterWithIp** | Register MSA with Ip instead of hostname. <ul><li>True if hostname of the MSA is not DNS registered.</li><li>False if hostname of the MSA is DNS registered. </li></ul> |
   | **Retain up to**  | Retention period of the cmdlet output. The default value is 60.  |
   | **Specify name for execution**  | Alphanumeric name, for example, **check_jetserverdetails**.  |
   | **Timeout**  |  The period after which a cmdlet exits if taking too long to finish.  |

1. Check **Notifications** to see the progress.  


## Uninstall JetStream DR

You'll uninstall JetStream DR in two steps. 


### Check current state of the JetStream appliance

You'll run the `Invoke-PreflightJetDRUninstall` cmdlet to diagnose the existing MSA VM and cluster configuration. It checks the current state of the JetStream DR appliance and whether the minimal requirements for the script are met:

- If the cluster details are correct 
- Has at least four hosts (minimum)
- If vCenter is registered to the MSA

1. Select **Run command** > **Packages** > **Invoke-PreflightJetDRUninstall**.

1. Provide the required values or change the default values, and then select **Run**.

   | **Field** | **Value** |
   | --- | --- |
   | **MSIp** | IP address of the MSA VM.  |
   | **Credential** | Credentials of root user of the MSA VM. It must be the same provided at the time of installation.  |
   | **ProtectedCluster** | Name of the protected cluster, for example, **Cluster-1**.  It must be the cluster that was provided at the time of installation. |
   | **Retain up to**  | Retention period of the cmdlet output. The default value is 60.  |
   | **Specify name for execution**  | Alphanumeric name, for example, **uninstallcheck_jetserverdetails**.  |
   | **Timeout**  |  The period after which a cmdlet exits if taking too long to finish.  |

1. Check **Notifications** to see the progress.  




### Uninstall JetDR

You'll run the `Uninstall-JetDR` cmdlet to uninstall JetStream DR and its components.  It unconfigures the cluster, unregisters vCenter from the MSA, and then removes the user.

1. Select **Run command** > **Packages** > **Uninstall-JetDR**.

1. Provide the required values or change the default values, and then select **Run**.

   | **Field** | **Value** |
   | --- | --- |
   | **MSIp** | IP address of the MSA VM.  |
   | **Credential** | Credentials of root user of the MSA VM. It must be the same provided at the time of installation.   |
   | **ProtectedCluster** | Name of the protected cluster, for example, **Cluster-1**.  It must be the cluster that was provided at the time of installation. |
   | **Retain up to**  | Retention period of the cmdlet output. The default value is 60.  |
   | **Specify name for execution**  | Alphanumeric name, for example, **uninstallcheck_jetserverdetails**.  |
   | **Timeout**  |  The period after which a cmdlet exits if taking too long to finish.  |

1. Check **Notifications** to see the progress.  


## Next steps

- [JetStream DR for Azure VMware Solution - Full demo](https://vimeo.com/475620858/2ce9413248)
   
   - [Getting started with JetStream DR for Azure VMware Solution](https://vimeo.com/491880696/ec509ff8e3)

   - [Configuration and Protecting VMs](https://vimeo.com/491881616/d887590fb2)

   - [Failover to Azure VMware Solution](https://vimeo.com/491883564/ca9fc57092)

   - [Failback to On-premises](https://vimeo.com/491884402/65ee817b60)

- [JetStream DR for Azure VMware Solution Infrastructure Setup](https://vimeo.com/480574312/b5386a871c) (*technical details, no voice track*)
